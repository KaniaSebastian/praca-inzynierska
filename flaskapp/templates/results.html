{% if current_user.is_admin %}
    {% extends "admin/layout_admin.html" %}
{% elif current_user.group.is_containing_sections%}
    {% extends "layout_section.html" %}
{% else %}
    {% extends "layout_user.html" %}
{% endif %}


{% block content %}

    {% if group.rating_status != 'ended' %}
        {% if current_user.is_admin %}
            <div class="jumbotron">
              <p class="lead">Ocenianie nie zostało jeszcze zakończone. Możesz zakończyć ocenianie w sekcji "Zarządzanie grupami".</p>
            </div>
        {% else %}
            <div class="jumbotron">
              <p class="lead">Ocenianie nie zostało jeszcze zakończone. Wyniki ukażą się po zakończeniu oceniania przez grupę.</p>
            </div>
        {% endif %}
    {% else %}

        {% if not current_user.is_admin %}
            {% if user_project %}
                <h4><p>Twój <a href="{{ url_for('main.project_view') }}">projekt</a> uzyskał <b> {{ user_project.score }} pkt</b>.</p></h4>
            {% endif %}
        {% endif %}

        <h6><p>W głosowaniu wzięło udział {{ users_that_rated_num }} użytkowników.</p></h6>

        <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="view-tab" data-toggle="tab" href="#view" role="tab" aria-controls="view" aria-selected="true">Podgląd</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="table-tab" data-toggle="tab" href="#table" role="tab" aria-controls="table" aria-selected="false">Tabela</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="view" role="tabpanel" aria-labelledby="home-tab">
              {% for section_num, project in group_projects_sorted.items() %}
                {% if user_project and project == user_project %}
                    <div class="card mb-3 mx-auto border border-info bg-light" style="max-width: 720px;">
                {% else %}
                    <div class="card mb-3 mx-auto" style="max-width: 720px;">
                {% endif %}
                  <div class="card-header">
                      Sekcja nr. {{ section_num }} zdobyła <b> {{ project.score }} pkt</b>.
                  </div>
                  <div class="row no-gutters">
                    <div class="col-md-4 border-bottom">
                        <a href="{{ url_for('static', filename='projects/' + project.upload_file) }} " target="_blank">
                            {% set extension = project.upload_file.split('.') %}
                            {% if extension[1] == 'pdf' %}
                                <img src="{{ url_for('static', filename='default_pdf_icon.png') }}" class="card-img" alt="PDF">
                            {% else %}
                                <img src="{{ url_for('static', filename='projects/' + project.upload_file) }}" class="card-img" alt="Grafika">
                            {% endif %}
                        </a>
                    </div>
                    <div class="col-md-8 border-left">
                      <div class="card-body">
                        <h5 class="card-title">{{ project.title }}</h5>
                        <p class="card-text">{{ project.description }}</p>
                        {% if project.optional_link %}
                            <p class="blockquote-footer mt-5"> <a class="text-secondary" href="{{ project.optional_link }}" target="_blank" title="{{ project.optional_link }}">Dodatkowy załącznik<i class="fa fa-external-link fa-lg text-info ml-1"></i></a> </p>
                        {% endif %}
                        <p class="card-text custom-card-footer">
                            {% if project.author.group.upload_time and project.date_posted < project.author.group.upload_time %}
                                <small class="text-muted">Ostatnio edytowano: <span class="text-success"><b> {{ project.date_posted.strftime('%d-%m-%Y') }} </b> o godzinie <b> {{ project.date_posted.strftime('%H:%M') }}</b></span></small>
                            {% elif not project.author.group.upload_time %}
                                <small class="text-muted">Ostatnio edytowano: <span><b> {{ project.date_posted.strftime('%d-%m-%Y') }} </b> o godzinie <b> {{ project.date_posted.strftime('%H:%M') }}</b></span></small>
                            {% else %}
                                <small class="text-muted">Ostatnio edytowano: <span class="text-danger"><b> {{ project.date_posted.strftime('%d-%m-%Y') }} </b> o godzinie <b> {{ project.date_posted.strftime('%H:%M') }}</b></span></small>
                            {% endif %}
                        </p>
                      </div>
                    </div>
                  </div>
              </div>

            {% endfor %}
          </div>

          <div class="tab-pane fade" id="table" role="tabpanel" aria-labelledby="profile-tab">
            <table class="table table-hover text-center table-striped">
              <thead class="thead-dark">
                <tr>
                  <th scope="col">Sekcja</th>
                  <th scope="col">Zdobyte punkty</th>
                  {% if current_user.is_admin %}
                      <th scope="col">Ostatnia edycja</th>
                  {% endif %}
                </tr>
              </thead>

              <tbody>

              {% for section_num, project in group_projects.items() %}
                {% if not current_user.is_admin and project == user_project %}
                    <tr class="table-row-hover border border-thick" data-href=" {{ url_for('static', filename='projects/' + project.upload_file) }} ">
                {% else %}
                    <tr class="table-row-hover" data-href=" {{ url_for('static', filename='projects/' + project.upload_file) }} ">
                {% endif %}
                  <td>Sekcja {{ section_num }}</td>
                  <td>{{ project.score }}</td>
                  {% if current_user.is_admin %}
                      <td>
                        {% if project.author.group.upload_time and project.date_posted < project.author.group.upload_time %}
                            <span class="text-success"><b> w terminie </b> <i class="fa fa-info-circle text-info" data-toggle="tooltip" data-placement="top" title="{{ project.date_posted.strftime('%d-%m-%Y') }} o godzinie {{ project.date_posted.strftime('%H:%M') }}"></i> </span>
                        {% elif not project.author.group.upload_time %}
                            <span><b> w terminie</b></span>
                        {% else %}
                            <span class="text-danger"><b> po terminie </b> <i class="fa fa-info-circle text-info" data-toggle="tooltip" data-placement="top" title="{{ project.date_posted.strftime('%d-%m-%Y') }} o godzinie {{ project.date_posted.strftime('%H:%M') }}"></i> </span>
                        {% endif %}
                      </td>
                  {% else %}
                  {% endif %}
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

    {% endif %}

{% endblock content %}

{% block scripts %}
    {{ super() }}
    <script type=text/javascript>
        $(document).ready(function($) {
            $(".table-row-hover").click(function() {
                window.open($(this).data("href"), '_blank');
            });
        });
    </script>
{% endblock scripts %}